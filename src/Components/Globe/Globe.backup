import { useEffect } from "react";
import Globe from "globe.gl";
import earth from "./map.jpg";
import data from "./geo.json";

const pointsData = data.features.map((feature) => ({
  lat: feature.geometry.coordinates[1],
  lng: feature.geometry.coordinates[0],
  name: feature.properties.Prop,
}));
console.log(pointsData);

// data.features = data.features.map((f) => {
//   return {
//     // ...f,
//     properties: {
//       NAME: f.properties.NAME,
//       CONTINENT: f.properties.CONTINENT,
//     },
//     geometry: {
//       ...f.geometry,
//     },
//   };
// });
// console.log(data);

const GlobeComponent = () => {
  useEffect(() => {
    const markerSvg = `<svg viewBox="-4 0 36 36">
    <path fill="currentColor" d="M14,0 C21.732,0 28,5.641 28,12.6 C28,23.963 14,36 14,36 C14,36 0,24.064 0,12.6 C0,5.641 6.268,0 14,0 Z"></path>
    <circle fill="black" cx="14" cy="14" r="7"></circle>
    </svg>`;
    const tooltip = document.createElement("div");
    tooltip.id = "tooltip";
    tooltip.style.position = "absolute";
    tooltip.style.display = "none";
    tooltip.style.backgroundColor = "rgba(0, 0, 0, 0.7)";
    tooltip.style.padding = "5px";
    tooltip.style.color = "white";
    tooltip.style.fontSize = "14px";
    document.body.appendChild(tooltip);

    // Gen random data
    // const N = 1;
    // const gData = [...Array(N).keys()].map(() => ({
    //   lat: (Math.random() - 0.5) * 180,
    //   lng: (Math.random() - 0.5) * 360,
    //   size: 7 + Math.random() * 30,
    //   color: ["red", "white", "blue", "green"][Math.round(Math.random() * 3)],
    // }));
    // console.log(gData);
    // eslint-disable-next-line no-unused-vars
    const world = Globe()
      .backgroundColor("white")
      .atmosphereColor("black")
      .globeImageUrl(earth)
      .htmlElementsData(pointsData)
      .pointsData(pointsData)
      .pointColor(() => "red") // set the color of the points to red
      .pointAltitude(0.1) // set the altitude of the points to 0.1 (relative to the globe radius)
      .pointRadius(0.5)
      // .htmlElementsData(gData)
      .htmlElement((d) => {
        const el = document.createElement("div");
        el.innerHTML = markerSvg;
        el.style.color = d.color;
        el.style.width = `${d.size}px`;

        el.style["pointer-events"] = "auto";
        el.style.cursor = "pointer";
        el.onmouseenter = (event) => {
          tooltip.innerHTML = d.name;
          tooltip.style.display = "block";
          tooltip.style.left = `${event.clientX}px`;
          tooltip.style.top = `${event.clientY}px`;
        };
        el.onmouseleave = () => {
          tooltip.style.display = "none";
        };
        el.onclick = () => {
          console.log(d); // handle click event here
        };
        return el;
      })(document.getElementById("globeViz"));
  }, []);
  return (
    <div className="">
      <div id="globeViz" className="w-[100vw]"></div>
    </div>
  );
};

export default GlobeComponent;
